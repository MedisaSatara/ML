﻿// This file was auto-generated by ML.NET Model Builder. 
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers;
using Microsoft.ML;

namespace Ml_deskriptivna
{
    public partial class MLModel1
    {
        /// <summary>
        /// Retrains model using the pipeline generated as part of the training process. For more information on how to load data, see aka.ms/loaddata.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <param name="trainData"></param>
        /// <returns></returns>
        public static ITransformer RetrainPipeline(MLContext mlContext, IDataView trainData)
        {
            var pipeline = BuildPipeline(mlContext);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"Row Labels", @"Row Labels"),new InputOutputColumnPair(@"P-12", @"P-12"),new InputOutputColumnPair(@"P-140", @"P-140"),new InputOutputColumnPair(@"P-141", @"P-141"),new InputOutputColumnPair(@"P-142", @"P-142"),new InputOutputColumnPair(@"P-143", @"P-143"),new InputOutputColumnPair(@"P-145", @"P-145"),new InputOutputColumnPair(@"P-146", @"P-146"),new InputOutputColumnPair(@"P-147", @"P-147"),new InputOutputColumnPair(@"P-148", @"P-148"),new InputOutputColumnPair(@"P-149", @"P-149"),new InputOutputColumnPair(@"P-150", @"P-150"),new InputOutputColumnPair(@"P-151", @"P-151"),new InputOutputColumnPair(@"P-152", @"P-152"),new InputOutputColumnPair(@"P-153", @"P-153"),new InputOutputColumnPair(@"P-154", @"P-154"),new InputOutputColumnPair(@"P-155", @"P-155"),new InputOutputColumnPair(@"P-156", @"P-156"),new InputOutputColumnPair(@"P-157", @"P-157"),new InputOutputColumnPair(@"P-158", @"P-158"),new InputOutputColumnPair(@"P-159", @"P-159"),new InputOutputColumnPair(@"P-160", @"P-160"),new InputOutputColumnPair(@"P-161", @"P-161"),new InputOutputColumnPair(@"P-162", @"P-162"),new InputOutputColumnPair(@"P-175", @"P-175"),new InputOutputColumnPair(@"P-176", @"P-176"),new InputOutputColumnPair(@"P-177", @"P-177"),new InputOutputColumnPair(@"P-178", @"P-178"),new InputOutputColumnPair(@"P-218", @"P-218"),new InputOutputColumnPair(@"P-219", @"P-219"),new InputOutputColumnPair(@"P-220", @"P-220"),new InputOutputColumnPair(@"P-221", @"P-221"),new InputOutputColumnPair(@"P-222", @"P-222"),new InputOutputColumnPair(@"P-223", @"P-223"),new InputOutputColumnPair(@"P-224", @"P-224"),new InputOutputColumnPair(@"P-225", @"P-225"),new InputOutputColumnPair(@"P-226", @"P-226"),new InputOutputColumnPair(@"P-227", @"P-227"),new InputOutputColumnPair(@"P-228", @"P-228"),new InputOutputColumnPair(@"P-229", @"P-229"),new InputOutputColumnPair(@"P-230", @"P-230"),new InputOutputColumnPair(@"P-231", @"P-231"),new InputOutputColumnPair(@"P-232", @"P-232"),new InputOutputColumnPair(@"P-233", @"P-233"),new InputOutputColumnPair(@"P-234", @"P-234"),new InputOutputColumnPair(@"P-235", @"P-235"),new InputOutputColumnPair(@"P-236", @"P-236"),new InputOutputColumnPair(@"P-237", @"P-237"),new InputOutputColumnPair(@"P-238", @"P-238"),new InputOutputColumnPair(@"P-239", @"P-239"),new InputOutputColumnPair(@"P-24", @"P-24"),new InputOutputColumnPair(@"P-240", @"P-240"),new InputOutputColumnPair(@"P-241", @"P-241"),new InputOutputColumnPair(@"P-246", @"P-246"),new InputOutputColumnPair(@"P-247", @"P-247"),new InputOutputColumnPair(@"P-276", @"P-276"),new InputOutputColumnPair(@"P-277", @"P-277"),new InputOutputColumnPair(@"P-278", @"P-278"),new InputOutputColumnPair(@"P-279", @"P-279"),new InputOutputColumnPair(@"P-280", @"P-280"),new InputOutputColumnPair(@"P-33", @"P-33"),new InputOutputColumnPair(@"P-45", @"P-45"),new InputOutputColumnPair(@"P-50", @"P-50"),new InputOutputColumnPair(@"P-58", @"P-58"),new InputOutputColumnPair(@"P-7", @"P-7"),new InputOutputColumnPair(@"P-8", @"P-8"),new InputOutputColumnPair(@"P-85", @"P-85"),new InputOutputColumnPair(@"P-88", @"P-88"),new InputOutputColumnPair(@"Grand Total", @"Grand Total")})      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"Row Labels",@"P-12",@"P-140",@"P-141",@"P-142",@"P-143",@"P-145",@"P-146",@"P-147",@"P-148",@"P-149",@"P-150",@"P-151",@"P-152",@"P-153",@"P-154",@"P-155",@"P-156",@"P-157",@"P-158",@"P-159",@"P-160",@"P-161",@"P-162",@"P-175",@"P-176",@"P-177",@"P-178",@"P-218",@"P-219",@"P-220",@"P-221",@"P-222",@"P-223",@"P-224",@"P-225",@"P-226",@"P-227",@"P-228",@"P-229",@"P-230",@"P-231",@"P-232",@"P-233",@"P-234",@"P-235",@"P-236",@"P-237",@"P-238",@"P-239",@"P-24",@"P-240",@"P-241",@"P-246",@"P-247",@"P-276",@"P-277",@"P-278",@"P-279",@"P-280",@"P-33",@"P-45",@"P-50",@"P-58",@"P-7",@"P-8",@"P-85",@"P-88",@"Grand Total"}))      
                                    .Append(mlContext.Transforms.Conversion.MapValueToKey(outputColumnName:@"P-104",inputColumnName:@"P-104"))      
                                    .Append(mlContext.Transforms.NormalizeMinMax(@"Features", @"Features"))      
                                    .Append(mlContext.MulticlassClassification.Trainers.SdcaMaximumEntropy(new SdcaMaximumEntropyMulticlassTrainer.Options(){L1Regularization=1F,L2Regularization=0.1F,LabelColumnName=@"P-104",FeatureColumnName=@"Features"}))      
                                    .Append(mlContext.Transforms.Conversion.MapKeyToValue(outputColumnName:@"PredictedLabel",inputColumnName:@"PredictedLabel"));

            return pipeline;
        }
    }
}
